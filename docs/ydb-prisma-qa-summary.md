# Краткие ответы на вопросы 4–6 по адаптеру Prisma ↔ YDB

## 4. Дополнительные архитектурные проблемы и решения
- **Маскировка под PostgreSQL.** `PostgresCompatibilityAdapter` и фабрика объявляют провайдера `postgres`, из-за чего миграции и introspection Prisma полагаются на постгрессовую семантику. *Решение*: договориться о регистрации родного провайдера `ydb` во всех компонентах Prisma и после этого отказаться от временных хардкодов.
- **Неограниченный рост числа сессий.** `YdbSessionPool.acquire` создаёт новые сессии, даже если достигнут желаемый размер пула, и ограничение проверяется только при возврате. *Решение*: учитывать общее число активных сессий и ставить новые запросы в очередь либо перейти на штатный `SessionPool` из SDK, который контролирует лимиты.
- **`rowsAffected` всегда равно нулю.** Запросы выполняются со `StatsMode.NONE`, а нормализатор результатов игнорирует метаданные. *Решение*: включить `StatsMode.BASIC`/`FULL`, извлекать счётчики модификаций из ответа YDB и отдавать их Prisma.

## 5. Регистрация провайдера `ydb` в Prisma
- Провайдер — это ключ маршрутизации между адаптерами, Query Engine, клиентом и миграционными инструментами. Сейчас публичные типы и фабрики перечисляют только `mysql`, `postgres`, `sqlite`, `sqlserver`.
- Чтобы `ydb` стал полноправным провайдером, нужно добавить идентификатор в `@prisma/driver-adapter-utils` и список `officialPrismaAdapters`, расширить `ConnectorType` клиента, а также внедрить поддержку в Query Engine, миграциях и CLI. Простое дополнение объединённого типа `| "ydb"` без этих реализаций приведёт к сбоям во время генерации или выполнения.

## 6. Возможность CRUD через Prisma Client без raw SQL
- Playground использует `$executeRaw` и `$queryRaw`, потому что в `schema.prisma` нет моделей, а провайдер выставлен как `postgresql`.
- Даже после добавления моделей Prisma сгенерирует PostgreSQL-совместимый SQL, тогда как адаптер ожидает готовый YQL; YDB SDK не выполняет трансформацию SQL→YQL.
- Чтобы пользоваться стандартными методами Prisma (`prisma.model.create`, `findMany` и т.п.), необходимо либо встроить полноценную поддержку `ydb` в саму Prisma (генерация YQL, миграции, introspection), либо реализовать в адаптере перевод SQL→YQL. Пока этого нет, raw YQL остаётся единственным рабочим вариантом.
